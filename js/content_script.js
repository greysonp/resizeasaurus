// Generated by IcedCoffeeScript 1.6.3-f
(function() {
  var Claps, Jaws, Main, main,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };



  Jaws = (function() {
    Jaws.prototype.STATES = {
      HIDING: 1,
      HIDDEN: 2,
      PEEKING: 3,
      CHOMPING: 4
    };

    Jaws.prototype.HEIGHT = 100;

    Jaws.prototype.PEEK_TIME = 1000;

    Jaws.prototype.TRANSITION_TIME = 500;

    Jaws.prototype.CHOMP_COOLDOWN = 1000;

    Jaws.prototype.DONE_COOLDOWN = 2500;

    Jaws.prototype.TEETH_PERCENT = .3;

    Jaws.prototype.closed = false;

    Jaws.prototype.couldChomp = false;

    Jaws.prototype.doneTimer = null;

    function Jaws() {
      this.state = this.STATES.HIDDEN;
      $('body').prepend("<div id=\"monster-t\">\n    <div class=\"monster-l\"></div>\n    <div class=\"monster-m\"></div>\n    <div class=\"monster-r\"></div>\n</div>\n<div id=\"monster-b\">\n    <div class=\"monster-l\"></div>\n    <div class=\"monster-m\"></div>\n    <div class=\"monster-r\"></div>\n</div>");
    }

    Jaws.prototype.tween = function(percentClosed) {
      if (this.state === this.STATES.CHOMPING) {
        this.chompTween(percentClosed);
      } else if (this.state !== this.STATES.HIDING) {
        this.peek(percentClosed);
      }
    };

    Jaws.prototype.peek = function(percentClosed) {
      var pixelOffset;
      pixelOffset = percentClosed * this.HEIGHT - this.HEIGHT;
      this.state = this.STATES.PEEKING;
      $('#monster-t').css('top', pixelOffset);
      $('#monster-b').css('bottom', pixelOffset);
      if (percentClosed === 1) {
        this.closed = true;
        if (this.couldChomp) {
          this.chomp();
          this.couldChomp = false;
        }
      } else if (this.closed) {
        this.closed = false;
        this.couldChomp = true;
        this.startChompTimer();
      }
    };

    Jaws.prototype.chompTween = function(percentClosed) {
      var adjustedHeight, pixelOffset;
      adjustedHeight = this.HEIGHT * (1 - this.TEETH_PERCENT);
      pixelOffset = percentClosed * adjustedHeight - adjustedHeight;
      pixelOffset = pixelOffset > 0 ? 0 : pixelOffset;
      $('#monster-t').css('top', pixelOffset);
      $('#monster-b').css('bottom', pixelOffset);
      if (percentClosed === 1) {
        this.closed = true;
        if (this.couldChomp) {
          this.chomp();
          this.couldChomp = false;
          this.startDoneTimer();
        }
      } else if (this.closed) {
        this.closed = false;
        this.couldChomp = true;
      }
    };

    Jaws.prototype.chomp = function() {
      this.state = this.STATES.CHOMPING;
      this.resetDoneTimer();
      console.log("CHOMP");
    };

    Jaws.prototype.hide = function() {
      var _this = this;
      this.state = this.STATES.HIDING;
      this.couldChomp = false;
      this.closed = false;
      this.hideHalf('#monster-t', 'top');
      this.hideHalf('#monster-b', 'bottom');
      setTimeout(function() {
        _this.state = _this.STATES.HIDDEN;
        _this.submitWreckage();
      }, this.TRANSITION_TIME);
    };

    Jaws.prototype.hideHalf = function(selector, property) {
      var props;
      props = {};
      props[property] = -this.HEIGHT;
      $(selector).animate(props, this.TRANSITION_TIME);
    };

    Jaws.prototype.reset = function() {
      if (this.state !== this.STATES.CHOMPING) {
        this.state = this.STATES.HIDDEN;
        $('#monster-t').css('top', -this.HEIGHT);
        $('#monster-b').css('bottom', -this.HEIGHT);
      }
    };

    Jaws.prototype.startChompTimer = function() {
      var _this = this;
      setTimeout(function() {
        _this.couldChomp = false;
      }, this.CHOMP_COOLDOWN);
    };

    Jaws.prototype.startDoneTimer = function() {
      var _this = this;
      if (this.doneTimer != null) {
        return;
      }
      this.doneTimer = setTimeout(function() {
        _this.hide();
      }, this.DONE_COOLDOWN);
    };

    Jaws.prototype.resetDoneTimer = function() {
      if (this.doneTimer != null) {
        clearTimeout(this.doneTimer);
        this.doneTimer = null;
        return this.startDoneTimer();
      }
    };

    Jaws.prototype.submitWreckage = function() {
      console.log("THIS SITE GOT WRECKED");
    };

    return Jaws;

  })();

  Claps = (function() {
    Claps.prototype.STATES = {
      HIDDEN: 0,
      CLAPPING: 1
    };

    Claps.prototype.WIDTH = 100;

    Claps.prototype.MIN_WIDTH = 400;

    Claps.prototype.number_of_claps = 0;

    Claps.prototype.WAIT_TIME = 2500;

    Claps.prototype.DONE_TIME = 1000;

    function Claps() {
      this.state = this.STATES.HIDDEN;
      $('body').prepend("<div class='left-hand'>\n</div>\n<div class='right-hand'>\n</div>");
      return;
    }

    Claps.prototype.clapping = function(percentClapped, width) {
      var pixelOffset;
      this.state = this.STATES.CLAPPING;
      pixelOffset = 100 * percentClapped;
      $('.left-hand').css('left', pixelOffset);
      $('.right-hand').css('right', pixelOffset);
      if (width === 400) {
        this.number_of_claps += 0.5;
      }
    };

    Claps.prototype.reset = function() {
      var _this = this;
      if (this.state === this.STATES.HIDDEN) {
        $('.left-hand').css("left", -this.WIDTH);
        $('.right-hand').css("right", -this.WIDTH);
      } else {
        this.state = this.STATES.HIDDEN;
        setTimeout(function() {
          _this.done();
        }, this.DONE_TIME);
      }
    };

    Claps.prototype.done = function() {
      var _this = this;
      return setTimeout(function() {
        _this.submitRespect();
      }, this.WAIT_TIME);
    };

    Claps.prototype.submitRespect = function() {
      console.log("GIVE THIS SITE SOME RESPECT " + this.number_of_claps);
    };

    return Claps;

  })();

  Main = (function() {
    Main.MIN_WIDTH = 400;

    Main.MIN_HEIGHT = 200;

    Main.PEEK_THRESHOLD = 300;

    Main.CLAP_THRESHOLD = 650;

    function Main() {
      this.onResize = __bind(this.onResize, this);
      this.jaws = new Jaws;
      this.claps = new Claps;
      $(window).resize(this.onResize);
    }

    Main.prototype.onResize = function() {
      this.resizeHeight($(window).height());
      this.resizeWidth($(window).width());
    };

    Main.prototype.resizeHeight = function(height) {
      var percentClosed, pixelsToClose;
      if (height < Main.PEEK_THRESHOLD) {
        pixelsToClose = height - Main.MIN_HEIGHT;
        percentClosed = 1 - (pixelsToClose / (Main.PEEK_THRESHOLD - Main.MIN_HEIGHT));
        this.jaws.tween(percentClosed);
      } else {
        this.jaws.reset();
      }
    };

    Main.prototype.resizeWidth = function(width) {
      var percentClosed, pixelsToClose;
      if (width < Main.CLAP_THRESHOLD) {
        pixelsToClose = width - Main.MIN_WIDTH;
        percentClosed = 1 - (pixelsToClose / (Main.CLAP_THRESHOLD - Main.MIN_WIDTH));
        this.claps.clapping(percentClosed, width);
      } else {
        this.claps.reset();
      }
    };

    return Main;

  })();

  main = new Main;

}).call(this);
